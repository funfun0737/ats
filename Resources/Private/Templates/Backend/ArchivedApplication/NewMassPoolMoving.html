{namespace ats=PAGEmachine\Ats\ViewHelpers}
<f:form action="setMassPoolMoving">

	<div class="panel panel-default">
		<div class="panel-heading">
			<div class="form-inline">
				Move Applications
			</div>
		</div>
		<div class="panel-body">
			<f:for each="{applications}" as="application">
				<f:form.hidden name="applications[{application.uid}]" value="{application.uid}" />
			</f:for>

			<div class="panel panel-default">
				<div class="panel-heading">
					<f:translate key="be.label.Applications" /> (<f:count>{applications}</f:count>)
					<a href="#" title="Collapse table" class="pull-right t3js-toggle-recordlist" data-toggle="collapse" data-target="#application-notes" aria-expanded="true">
						<span class="collapseIcon">
							<core:icon identifier="actions-view-list-expand" size="small" />
						</span>
					</a>
				</div>
				<div class="collapse" data-state="collapsed" id="application-notes">
					<div class="panel-body">
						<table class="applications-list table">
							<thead>
								<tr>
									<th>#</th>
									<th><f:translate key="be.label.MyApplications.Table.Created"/></th>
									<th>Name</th>
									<th>ID</th>
									<th><f:translate key="be.label.MyApplications.Table.JobNumber"/></th>
									<th>Status</th>
									<th><f:translate key="be.label.MyApplications.Table.Rating"/></th>
									<th><f:translate key="be.label.MyApplications.Table.Disability"/></th>
									<th><f:translate key="be.label.MyApplications.Table.Employed"/></th>
									<th><f:translate key="be.label.MyApplications.Table.LatestNote"/></th>
								</tr>
							</thead>
							<tbody>
								<f:for each="{applications}" as="application" iteration="i">
									<tr>
										<td>{i.index}</td>
										<td data-order="{application.creationDate -> f:format.date(format: 'U')}"><f:format.date format="d.m.Y H:i">{application.creationDate}</f:format.date></td>
										<td>
											<f:link.action action="show" arguments="{application : application}">{application.surname}, {application.firstname}</f:link.action>
										</td>
										<td>{application.uid}</td>
										<td>{application.job.jobNumber}</td>
										<td><f:translate key="tx_ats.application.status.{application.status}">{application.status}</f:translate></td>
										<td><f:translate key="tx_ats.application.Rating.{application.rating}" /></td>
										<td><f:translate key="tx_ats.label.disability.{application.disability}" /></td>
										<td><f:translate key="tx_ats.label.employed.{application.employed}" /></td>
										<td style="max-width: 250px;">
											<f:format.crop maxCharacters="100"><f:format.raw>{application.latestNote.details}</f:format.raw></f:format.crop>
											<f:if condition="{f:count(subject:application.notes)} > 1">
													(<f:link.action action="notes" arguments="{application : application}">+{application.notes -> f:count()} more</f:link.action>)
											</f:if>
										</td>
									</tr>
								</f:for>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="form-group">
				<f:form.select
					name="job"
					options="{jobs}"
					optionLabelField="jobNumberAndTitle"
					optionValueField="uid"
					class="form-control"
				/>
			</div>

			<div class="form-group">
				<ats:form.translatableSelect name="status" options="{statusOptions}" translationPrefix="tx_ats.application.status." class="form-control" />
			</div>

			<div class="form-group">
				<f:form.hidden name="note[subject]" value="Status" />
				<f:form.hidden name="note[user]" value="{beUser.uid}" />

				<label for="details"><f:translate id="be.label.ApplicationSingle.Workflow.Note"/></label>

				<f:form.textarea name="note[details]" id="details" rows="7" class="form-control" />
			</div>

			<div class="form-group">
				<f:form.submit value="<f:translate id='be.label.ApplicationSingle.Workflow.Submit'/>" class="btn btn-primary" />
			</div>

		</div>

	</div>

</f:form>
